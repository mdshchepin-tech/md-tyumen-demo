<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ ‚Äî –ì–ö ¬´–ú–∞—Ç—å –∏ –¥–∏—Ç—è¬ª</title>
  <meta name="description" content="–û–±—É—á–∞—é—â–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –≤ —Å—Ç–∏–ª–µ –ì–ö ¬´–ú–∞—Ç—å –∏ –¥–∏—Ç—è¬ª. –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GitHub Pages.">
  <style>
    :root{
      /* –õ–ï–ì–ö–û –ü–û–î–°–¢–†–û–ò–¢–¨ –§–ò–†–ú–ï–ù–ù–´–ô –°–¢–ò–õ–¨ –ó–î–ï–°–¨ */
      --brand-primary:#d94a4a;   /* —Ç—ë–ø–ª—ã–π –∞–∫—Ü–µ–Ω—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) */
      --brand-primary-600:#bf3f3f;
      --brand-primary-100:#fdeaea;
      --brand-accent:#f6b94c;    /* –º—è–≥–∫–∏–π –∞–∫—Ü–µ–Ω—Ç */
      --bg:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --ok:#1b8f5a;
      --bad:#b42318;
      --surface:#ffffff;
      --card:#ffffff;
      --shadow:0 6px 30px rgba(0,0,0,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial}
    img,video{max-width:100%;height:auto;border-radius:12px}
    a{color:var(--brand-primary);text-decoration:none}
    a:hover{color:var(--brand-primary-600);text-decoration:underline}
    .container{max-width:980px;margin:0 auto;padding:24px}
    header{
      display:flex;gap:16px;align-items:center;justify-content:center;
      padding:20px 12px;border-bottom:1px solid #eee;background:linear-gradient(180deg,var(--brand-primary-100),#fff 65%);
    }
    header img.logo{height:60px;width:auto}
    header h1{margin:0;font-weight:750;letter-spacing:.2px}
    .card{
      background:var(--card);border:1px solid #eee;border-radius:var(--radius);
      box-shadow:var(--shadow);padding:20px;margin:18px 0;
    }
    .muted{color:var(--muted)}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:12px 18px;
      background:var(--brand-primary);color:#fff;font-weight:700;cursor:pointer;
      box-shadow:0 6px 16px rgba(217,74,74,.28);transition:transform .05s ease,opacity .2s ease, background .2s ease
    }
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .btn:hover{background:var(--brand-primary-600)}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#111827;color:#fff}
    .btn.ghost{background:transparent;border:1px solid #ddd;color:#111827}
    .grid{display:grid;gap:14px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:760px){.grid.cols-2{grid-template-columns:1fr}}
    .section-card{
      border:1px solid #eee;border-radius:14px;overflow:hidden;background:#fff;cursor:pointer;
      transition:transform .1s ease, box-shadow .2s ease
    }
    .section-card:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(0,0,0,.08)}
    .section-card .body{padding:12px 14px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--brand-primary-100);color:var(--brand-primary);font-weight:700;font-size:12px}
    .form-row{display:flex;gap:12px;flex-wrap:wrap}
    .form-row .field{flex:1 1 240px;min-width:220px}
    .field label{display:block;font-weight:700;margin-bottom:6px}
    .field input, .field select{
      width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff
    }
    .question{padding:16px;border:1px solid #eee;border-radius:14px;margin:14px 0;background:#fff}
    .question h3{margin:.2rem 0 .6rem 0}
    .options{display:grid;gap:8px;margin-top:10px}
    .option{
      background:#fafafa;border:1px solid #eee;border-radius:12px;padding:10px 12px;display:flex;gap:10px;align-items:flex-start
    }
    .option.correct{outline:2px solid rgba(27,143,90,.25);background:#f0fbf6}
    .option.wrong{outline:2px solid rgba(180,35,24,.25);background:#fff6f5}
    .q-meta{display:flex;align-items:center;gap:8px;margin-top:8px}
    .q-meta .pill{font-size:12px;padding:4px 8px;border-radius:999px;background:#f3f4f6}
    .q-feedback{margin-top:10px;font-weight:700}
    .q-feedback.ok{color:var(--ok)}
    .q-feedback.bad{color:var(--bad)}
    .progress{height:10px;background:#f3f4f6;border-radius:999px;overflow:hidden}
    .progress > span{display:block;height:100%;background:var(--brand-accent);width:0%}
    .footer-note{font-size:13px;color:#6b7280;margin-top:10px}
    .result-box{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .winner{background:var(--brand-primary-100);border:1px dashed var(--brand-primary);color:var(--brand-primary);padding:12px 14px;border-radius:12px;font-weight:800}

    /* –ú–û–î–ê–õ ¬´–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º¬ª */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.38);
      display:flex;align-items:center;justify-content:center;padding:20px;z-index:50
    }
    .modal{max-width:720px;width:100%;background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:18px 18px 22px}
    .modal h2{margin:0 0 8px 0}
    .modal .rules{max-height:36vh;overflow:auto;border:1px solid #eee;border-radius:12px;padding:12px;background:#fafafa}
    .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}

    /* —Å–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ */
    .screen{display:none}
    .screen.active{display:block}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <!-- –ó–ê–ú–ï–ù–ò–¢–ï src –ù–ê –í–ê–® –§–ê–ô–õ –õ–û–ì–û–¢–ò–ü–ê –í –†–ï–ü–û–ó–ò–¢–û–†–ò–ò: images/logo.png -->
    <img class="logo" src="images/logo.png" alt="–ì–ö ¬´–ú–∞—Ç—å –∏ –¥–∏—Ç—è¬ª (–ª–æ–≥–æ—Ç–∏–ø)" onerror="this.style.display='none'">
    <h1>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ ‚Äî –ì–ö ¬´–ú–∞—Ç—å –∏ –¥–∏—Ç—è¬ª</h1>
  </header>

  <!-- –ú–û–î–ê–õ: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º -->
  <div id="rulesModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
    <div class="modal">
      <h2 id="rulesTitle">–ü—Ä–∞–≤–∏–ª–∞ —É—á–∞—Å—Ç–∏—è</h2>
      <div class="rules">
        <p><strong>–¶–µ–ª—å:</strong> –ø—Ä–æ–π—Ç–∏ —Ä–∞–∑–¥–µ–ª—ã ¬´–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –≥–∏–Ω–µ–∫–æ–ª–æ–≥–∏—è¬ª –∏ ¬´–ê–∫—É—à–µ—Ä—Å—Ç–≤–æ¬ª, –æ—Ç–≤–µ—Ç–∏–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.</p>
        <ul>
          <li>–í–æ–ø—Ä–æ—Å—ã –±—ã–≤–∞—é—Ç —Å –æ–¥–Ω–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –∏–ª–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏.</li>
          <li><strong>–°—á—ë—Ç:</strong> –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî <b>1 –±–∞–ª–ª</b>; –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä ‚Äî <b>0.5 –±–∞–ª–ª–∞</b> –∑–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, <b>1 –±–∞–ª–ª</b> –ø—Ä–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ–º –æ—Ç–≤–µ—Ç–µ (–±–µ–∑ —à—Ç—Ä–∞—Ñ–æ–≤).</li>
          <li>–ü—Ä–∏ —Å—É–º–º–µ –±–∞–ª–ª–æ–≤ <b>‚â• 5</b> –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´<b>–í—ã ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å! –ó–∞–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–∑!</b>¬ª.</li>
          <li>–ú–µ–¥–∏–∞ (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∏–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–ø–∫–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç–∏ –Ω–∞ —Å–≤–æ–∏ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏).</li>
          <li>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</li>
        </ul>
      </div>
      <div class="form-row" style="margin-top:10px">
        <div class="field">
          <label for="playerName">–í–∞—à–µ –∏–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <input id="playerName" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
        </div>
        <div class="field">
          <label for="playerDept">–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ / –≥—Ä—É–ø–ø–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <input id="playerDept" type="text" placeholder="–û—Ç–¥–µ–ª / —É—á–µ–±–Ω–∞—è –≥—Ä—É–ø–ø–∞">
        </div>
      </div>
      <label style="display:flex;gap:10px;align-items:flex-start;margin-top:10px">
        <input id="agree" type="checkbox">
        <span>–Ø –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω(–∞) —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ —Å–æ–≥–ª–∞—Å–µ–Ω(—Å–æ–≥–ª–∞—Å–Ω–∞) –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É.</span>
      </label>
      <div class="actions">
        <button id="startBtn" class="btn" disabled>–ù–∞—á–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <main class="container">
    <!-- –≠–ö–†–ê–ù 1: –≤—ã–±–æ—Ä —Ä–∞–∑–¥–µ–ª–∞ -->
    <section id="screen-sections" class="screen active">
      <div class="card">
        <h2 style="margin-top:0">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ</h2>
        <p class="muted">–ü–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –æ–±–ª–æ–∂–∫–∏: –∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã <code>images/section_art.jpg</code>, <code>images/section_ob.jpg</code> –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.</p>
        <div class="grid cols-2" id="sectionsGrid">
          <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º –∏–∑ QUIZ_DATA -->
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button id="startFullBtn" class="btn">–ü—Ä–æ–π—Ç–∏ –æ–±–∞ —Ä–∞–∑–¥–µ–ª–∞ –ø–æ–¥—Ä—è–¥</button>
          <a class="btn ghost" href="#" id="consiliumLink" title="–û—Ç–¥–µ–ª—å–Ω–∞—è –∏–≥—Ä–∞ ¬´–ö–æ–Ω—Å–∏–ª–∏—É–º¬ª (5 —ç—Ç–∞–ø–æ–≤)">–ö–æ–Ω—Å–∏–ª–∏—É–º (–æ—Ç–¥–µ–ª—å–Ω–æ)</a>
        </div>
        <p class="footer-note">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ JSON-–¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ (—Å–º. ¬´QUIZ_DATA¬ª –Ω–∏–∂–µ).</p>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">–í–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
        <div id="historyBox" class="muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ü—Ä–æ–π–¥–∏—Ç–µ –∏–≥—Ä—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn ghost" id="exportBtn">–í—ã–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (.json)</button>
          <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        </div>
      </div>
    </section>

    <!-- –≠–ö–†–ê–ù 2: —Å–∞–º —Ä–∞–∑–¥–µ–ª -->
    <section id="screen-quiz" class="screen">
      <div class="card" id="quizHeader">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
          <div>
            <div class="badge" id="sectionBadge">–†–∞–∑–¥–µ–ª</div>
            <h2 id="sectionTitle" style="margin:.4rem 0 0 0">...</h2>
            <div class="muted" id="playerLine"></div>
          </div>
          <button class="btn ghost" id="backToSections">‚Üê –∫ —Ä–∞–∑–¥–µ–ª–∞–º</button>
        </div>
        <div style="margin-top:12px">
          <div class="progress" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ä–∞–∑–¥–µ–ª—É"><span id="progressBar" style="width:0%"></span></div>
          <div class="muted" id="progressText" style="margin-top:6px">0 –∏–∑ 0</div>
        </div>
      </div>

      <div id="questionsHost"></div>

      <div class="card">
        <div class="result-box">
          <div>
            <div id="sectionScoreLine"><strong>–ë–∞–ª–ª—ã –∑–∞ —Ä–∞–∑–¥–µ–ª:</strong> 0</div>
            <div class="muted" style="margin-top:4px">–ü—Ä–∞–≤–∏–ª–∞ –ø–æ–¥—Å—á—ë—Ç–∞: –æ–¥–∏–Ω–æ—á–Ω—ã–π ‚Äî 1 –±–∞–ª–ª; –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π ‚Äî 0.5 –∑–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, 1 –±–∞–ª–ª –ø—Ä–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ–º.</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="finishSectionBtn">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–∑–¥–µ–ª</button>
            <button class="btn secondary" id="nextSectionBtn" style="display:none">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª ‚Üí</button>
          </div>
        </div>
      </div>
    </section>

    <!-- –≠–ö–†–ê–ù 3: –æ–±—â–∏–π –∏—Ç–æ–≥ -->
    <section id="screen-summary" class="screen">
      <div class="card">
        <h2 style="margin-top:0">–ò—Ç–æ–≥–∏</h2>
        <div id="totalsBox"></div>
        <div id="winnerBox" class="winner" style="display:none;margin-top:12px">üéâ –í—ã ‚Äî –ø–æ–±–µ–¥–∏—Ç–µ–ª—å! –ó–∞–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–∑!</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn" id="goHome">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
          <button class="btn ghost" id="exportBtn2">–í—ã–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (.json)</button>
        </div>
      </div>
    </section>
  </main>

  <!-- ====== –î–ê–ù–ù–´–ï –í–ò–ö–¢–û–†–ò–ù–´ (–û–¢–†–ï–î–ê–ö–¢–ò–†–£–ô–¢–ï –ü–û–î –°–ï–ë–Ø) ======
       –†–∞–∑–¥–µ–ª—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –Ω–∏–∂–µ ‚Äî –ü–†–ò–ú–ï–†. –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ–¥–∏–∞
       –Ω–∞ –≤–∞—à–∏ –∏–∑ –ø–∞–ø–∫–∏. –î–ª—è GitHub Pages –ø–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
       images/... –∏ videos/... –∏ –ø–æ–ø—Ä–∞–≤—å—Ç–µ –ø—É—Ç–∏ –≤ –ø–æ–ª—è—Ö media.
       –í–æ–ø—Ä–æ—Å—ã –° –û–î–ù–ò–ú –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º: type: "single"
       –° –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏: type: "multi" (–ø–æ–º–µ—Ç—å—Ç–µ correct:true —É –Ω—É–∂–Ω—ã—Ö –æ–ø—Ü–∏–π)
  -->
  <script>
    const QUIZ_DATA = {
      version: "1.0.0",
      consiliumUrl: "#", // –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–≥—Ä–∞ ¬´–ö–æ–Ω—Å–∏–ª–∏—É–º¬ª, –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å—Å—ã–ª–∫—É (GitHub Pages –¥—Ä—É–≥–æ–π —Ä–µ–ø—ã)
      sections: [
        {
          id: "art-gyne",
          title: "–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –≥–∏–Ω–µ–∫–æ–ª–æ–≥–∏—è",
          coverImage: "images/section_art.jpg",
          questions: [
            {
              id: "q1",
              type: "single",
              text: "–ö–∞–∫–æ–π –≥–∏–Ω–µ–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∫–∞–∑–∞–Ω –Ω–∞ –ø—Ä–µ–≥—Ä–∞–≤–∏–¥–∞—Ä–Ω–æ–º —ç—Ç–∞–ø–µ –ø—Ä–∏ –≤—ã—Ä–∞–∂–µ–Ω–Ω–æ–π –ò–¶–ù –≤ –∞–Ω–∞–º–Ω–µ–∑–µ –∏ —É–∫–æ—Ä–æ—á–µ–Ω–Ω–æ–π —à–µ–π–∫–µ –ø–æ—Å–ª–µ –∫–æ–Ω–∏–∑–∞—Ü–∏–∏?",
              media: { image: "images/art_q1.jpg", alt: "–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –∫ –≤–æ–ø—Ä–æ—Å—É (–∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª)" },
              options: [
                { text: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –≥–∏—Å—Ç–µ—Ä–æ—Å–∫–æ–ø–∏—è", correct: false },
                { text: "–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –ª–∞–ø–∞—Ä–æ—Å–∫–æ–ø–∏—è", correct: false },
                { text: "–õ–∞–ø–∞—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–∫–ª—è–∂", correct: true },  // ‚úÖ
                { text: "–í–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è", correct: false }
              ]
            },
            {
              id: "q2",
              type: "multi",
              text: "–û—Ç–º–µ—Ç—å—Ç–µ –≤–µ—Ä–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ –ø—Ä–µ–¥–≥—Ä–∞–≤–∏–¥–∞—Ä–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –ø–æ—Å–ª–µ –≠–ö–û:",
              media: { video: "videos/art_q2.mp4", poster: "images/art_q2_poster.jpg", alt: "–í–∏–¥–µ–æ (–∑–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª)" },
              options: [
                { text: "–û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–Ω–¥–æ–º–µ—Ç—Ä–∏—è –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≥–∏—Å—Ç–µ—Ä–æ—Å–∫–æ–ø–∏—é –ø—Ä–∏ –ø–æ–∫–∞–∑–∞–Ω–∏—è—Ö", correct: true }, // 0.5
                { text: "–°–∫—Ä–∏–Ω–∏–Ω–≥ –Ω–∞ –∏–Ω—Ñ–µ–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞—é—â–∏–µ—Å—è –ø–æ–ª–æ–≤—ã–º –ø—É—Ç—ë–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è", correct: false },
                { text: "–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –¥–µ—Ñ–∏—Ü–∏—Ç–æ–≤ (–≤–∏—Ç–∞–º–∏–Ω D, –∂–µ–ª–µ–∑–æ) —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –ø–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è–º", correct: true }, // 0.5 -> –ø—Ä–∏ –ø–æ–ª–Ω–æ—Ç–µ = 1
                { text: "–û—Ü–µ–Ω–∫–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Ä–∏—Å–∫–∞ –ü–û–ù–†–ü –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞", correct: false }
              ]
            }
          ]
        },
        {
          id: "obstetrics",
          title: "–ê–∫—É—à–µ—Ä—Å—Ç–≤–æ",
          coverImage: "images/section_ob.jpg",
          questions: [
            {
              id: "q3",
              type: "single",
              text: "–ü—Ä–∏ –ü–û–ù–†–ü –≤ I –ø–µ—Ä–∏–æ–¥–µ —Ä–æ–¥–æ–≤ –≤ –∞–Ω–∞–º–Ω–µ–∑–µ, —á—Ç–æ –≤–∞–∂–Ω–µ–µ –Ω–∞ —ç—Ç–∞–ø–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏?",
              options: [
                { text: "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–æ—Ä—ã —Ä–∏—Å–∫–∞, —ç—Ç–æ —Ä–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π", correct: false },
                { text: "–ö–æ–º–æ—Ä–±–∏–¥–Ω—ã–π –∞—É–¥–∏—Ç —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —Ä–∏—Å–∫–∞ –∏ –ø–ª–∞–Ω –Ω–∞–±–ª—é–¥–µ–Ω–∏—è", correct: true }, // ‚úÖ
                { text: "–ò—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–Ω–∞—Ç–∞–ª—å–Ω—ã–µ –≤–∏—Ç–∞–º–∏–Ω—ã –±–µ–∑ –¥—Ä—É–≥–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏", correct: false }
              ]
            },
            {
              id: "q4",
              type: "multi",
              text: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –ø—Ä–∏ —Ä–∏—Å–∫–µ –ò–¶–ù –≤ —Å–ª–µ–¥—É—é—â—É—é –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å:",
              options: [
                { text: "–†–∞–Ω–Ω—è—è —Å—Ç—Ä–∞—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∏—Å–∫–∞ –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ", correct: true }, // 0.5
                { text: "–°–µ—Ä–∫–ª—è–∂/–ø–µ—Å—Å–∞—Ä–∏–π –ø–æ –ø–æ–∫–∞–∑–∞–Ω–∏—è–º", correct: true },          // 0.5 ‚Üí –ø—Ä–∏ –ø–æ–ª–Ω–æ—Ç–µ = 1
                { text: "–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π", correct: false }
              ]
            }
          ]
        }
      ]
    };
  </script>

  <!-- ====== –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–ô –ò–ì–†–´ ====== -->
  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // –ö–õ–Æ–ß–ò –î–õ–Ø localStorage
    const LS_KEY_RESULTS = "md-quiz-results-v1"; // –º–∞—Å—Å–∏–≤ –ø–æ–ø—ã—Ç–æ–∫
    const LS_KEY_PLAYER = "md-quiz-player-v1";   // {name, dept}

    const elModal = $("#rulesModal");
    const elStartBtn = $("#startBtn");
    const elAgree = $("#agree");
    const elName = $("#playerName");
    const elDept = $("#playerDept");

    const elSections = $("#screen-sections");
    const elQuiz = $("#screen-quiz");
    const elSummary = $("#screen-summary");

    const elSectionsGrid = $("#sectionsGrid");
    const elConsilium = $("#consiliumLink");
    const elHistory = $("#historyBox");

    const elBack = $("#backToSections");
    const elSectionBadge = $("#sectionBadge");
    const elSectionTitle = $("#sectionTitle");
    const elPlayerLine = $("#playerLine");
    const elQHost = $("#questionsHost");
    const elProgressBar = $("#progressBar");
    const elProgressText = $("#progressText");
    const elSectionScoreLine = $("#sectionScoreLine");
    const elFinishSection = $("#finishSectionBtn");
    const elNextSection = $("#nextSectionBtn");

    const elTotalsBox = $("#totalsBox");
    const elWinnerBox = $("#winnerBox");

    const elStartFull = $("#startFullBtn");
    const elExport1 = $("#exportBtn");
    const elExport2 = $("#exportBtn2");
    const elReset = $("#resetBtn");
    const elGoHome = $("#goHome");

    let runMode = "single"; // 'single' | 'full'
    let currentSectionIndex = 0;
    let sectionState = null; // –±—É–¥–µ—Ç –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
    let sessionResults = []; // —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è

    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
    (function init(){
      // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –∏–≥—Ä–æ–∫–∞
      try{
        const saved = JSON.parse(localStorage.getItem(LS_KEY_PLAYER) || "null");
        if(saved && saved.name){ elName.value = saved.name; }
        if(saved && saved.dept){ elDept.value = saved.dept; }
      }catch{}
      // –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—Ç –¥–æ —Å–æ–≥–ª–∞—Å–∏—è –∏ –∏–º–µ–Ω–∏
      const validateModal = () => {
        const ok = !!elAgree.checked && elName.value.trim().length>1;
        elStartBtn.disabled = !ok;
      };
      ["input","change"].forEach(ev=>{
        elAgree.addEventListener(ev, validateModal);
        elName.addEventListener(ev, validateModal);
      });
      elStartBtn.addEventListener("click", ()=>{
        // —Å–æ—Ö—Ä–∞–Ω–∏–º –∏–≥—Ä–æ–∫–∞
        const player = { name: elName.value.trim(), dept: elDept.value.trim() };
        localStorage.setItem(LS_KEY_PLAYER, JSON.stringify(player));
        elModal.style.display = "none";
      });

      // —Å–ª–∏–Ω–∫—É–µ–º –∫–æ–Ω—Å–∏–ª–∏—É–º
      if(QUIZ_DATA.consiliumUrl && QUIZ_DATA.consiliumUrl !== "#"){
        elConsilium.href = QUIZ_DATA.consiliumUrl;
      }else{
        elConsilium.addEventListener("click", (e)=>{
          e.preventDefault();
          alert("–ö–æ–Ω—Å–∏–ª–∏—É–º ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–≥—Ä–∞ –Ω–∞ 5 —ç—Ç–∞–ø–æ–≤. –î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ –ø–æ–ª–µ consiliumUrl –≤ –±–ª–æ–∫–µ QUIZ_DATA.");
        });
      }

      // –ø–æ—Å—Ç—Ä–æ–∏–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤
      renderSections();

      // –∏—Å—Ç–æ—Ä–∏—è
      renderHistory();

      // –∫–Ω–æ–ø–∫–∏
      elStartFull.addEventListener("click", ()=>{
        runMode = "full";
        sessionResults = [];
        startSection(0);
      });
      elBack.addEventListener("click", ()=>switchScreen("sections"));
      elFinishSection.addEventListener("click", finishSection);
      elNextSection.addEventListener("click", ()=>{
        const next = currentSectionIndex + 1;
        if(next < QUIZ_DATA.sections.length){
          startSection(next);
        }else{
          // –≤ —Ä–µ–∂–∏–º–µ full –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
          showSummary();
        }
      });
      elExport1.addEventListener("click", exportResults);
      elExport2.addEventListener("click", exportResults);
      elReset.addEventListener("click", ()=>{
        if(confirm("–°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–æ—Ñ–∏–ª—å?")){
          localStorage.removeItem(LS_KEY_RESULTS);
          localStorage.removeItem(LS_KEY_PLAYER);
          renderHistory();
          alert("–î–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.");
        }
      });
      elGoHome.addEventListener("click", ()=>switchScreen("sections"));

      // –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ü–∏–∏ –ø–æ –∫–ª–∏–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏
      elSectionsGrid.addEventListener("click", (e)=>{
        const card = e.target.closest("[data-section-index]");
        if(!card) return;
        runMode = "single";
        sessionResults = [];
        startSection(parseInt(card.dataset.sectionIndex,10));
      });
    })();

    function renderSections(){
      elSectionsGrid.innerHTML = "";
      QUIZ_DATA.sections.forEach((s, idx)=>{
        const div = document.createElement("div");
        div.className = "section-card";
        div.tabIndex = 0;
        div.setAttribute("role","button");
        div.setAttribute("data-section-index", String(idx));
        div.innerHTML = `
          <img src="${escapeHtml(s.coverImage||"")}" alt="–û–±–ª–æ–∂–∫–∞: ${escapeHtml(s.title)}" onerror="this.style.display='none'">
          <div class="body">
            <span class="badge">–†–∞–∑–¥–µ–ª</span>
            <h3 style="margin:.4rem 0 .2rem 0">${escapeHtml(s.title)}</h3>
            <div class="muted">${s.questions.length} –≤–æ–ø—Ä–æ—Å(–æ–≤)</div>
          </div>
        `;
        elSectionsGrid.appendChild(div);
      });
    }

    function renderHistory(){
      const player = readPlayer();
      const rows = readResults();
      if(!rows.length){
        elHistory.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.";
        return;
      }
      const name = player?.name ? ` (${escapeHtml(player.name)})` : "";
      elHistory.innerHTML = `
        <div>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏${name}:</div>
        <ul style="margin:.4rem 0 .2rem 1rem">
          ${rows.slice(-5).reverse().map(r=>{
            const dt = new Date(r.timestamp);
            const pass = r.total>=5 ? " ‚Äî <b style='color:var(--ok)'>–ø–æ–±–µ–¥–∞</b>" : "";
            return `<li>${dt.toLocaleString()} ‚Äî <b>${r.total.toFixed(2)}</b> –±–∞–ª–ª–æ–≤${pass}</li>`;
          }).join("")}
        </ul>
      `;
    }

    function startSection(sectionIndex){
      currentSectionIndex = sectionIndex;
      sectionState = buildSectionState(QUIZ_DATA.sections[sectionIndex]);
      switchScreen("quiz");
      renderSection();
    }

    function buildSectionState(section){
      const answered = {}; // id –≤–æ–ø—Ä–æ—Å–∞ -> –¥–∞–Ω–Ω—ã–µ –≤—ã–±–æ—Ä–∞
      const scores = {};   // id –≤–æ–ø—Ä–æ—Å–∞ -> –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–∞–ª–ª—ã
      return { section, answered, scores, finished:false };
    }

    function renderSection(){
      const player = readPlayer();
      elSectionBadge.textContent = "–†–∞–∑–¥–µ–ª";
      elSectionTitle.textContent = sectionState.section.title;
      elPlayerLine.textContent = player?.name ? `–£—á–∞—Å—Ç–Ω–∏–∫: ${player.name}${player.dept? " ‚Ä¢ " + player.dept : ""}` : "";

      const totalQ = sectionState.section.questions.length;
      updateProgress();

      // –≤–æ–ø—Ä–æ—Å—ã
      elQHost.innerHTML = "";
      sectionState.section.questions.forEach((q, idx)=>{
        const qEl = document.createElement("div");
        qEl.className = "question";
        const typeLabel = q.type === "multi" ? "–ù–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç–æ–≤" : "–û–¥–∏–Ω –æ—Ç–≤–µ—Ç";
        qEl.innerHTML = `
          <div class="q-meta"><span class="pill">${typeLabel}</span><span class="muted">–í–æ–ø—Ä–æ—Å ${idx+1}/${totalQ}</span></div>
          <h3>${escapeHtml(q.text)}</h3>
          ${renderMedia(q.media)}
          <div class="options">
            ${q.options.map((opt, oi)=>{
              const name = \`q_\${q.id}\`;
              const inputType = q.type === "multi" ? "checkbox" : "radio";
              const inputId = \`q_\${q.id}_\${oi}\`;
              return \`
                <label class="option" data-qid="\${q.id}" data-oi="\${oi}">
                  <input id="\${inputId}" type="\${inputType}" name="\${name}" />
                  <span>\${escapeHtml(opt.text)}</span>
                </label>
              \`;
            }).join("")}
          </div>
          <div class="q-feedback" id="fb_${q.id}" aria-live="polite"></div>
        `;
        elQHost.appendChild(qEl);
      });

      // –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
      elQHost.addEventListener("change", onOptionChange);
      elFinishSection.style.display = "inline-block";
      elNextSection.style.display = "none";
      updateSectionScoreLine();
    }

    function renderMedia(media){
      if(!media) return "";
      if(media.image){
        return `<div style="margin:8px 0 4px 0"><img src="${escapeHtml(media.image)}" alt="${escapeHtml(media.alt||"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –≤–æ–ø—Ä–æ—Å—É")}" onerror="this.style.display='none'"></div>`;
      }
      if(media.video){
        const poster = media.poster ? \` poster="\${escapeHtml(media.poster)}"\` : "";
        return `<div style="margin:8px 0 4px 0"><video ${poster} controls preload="metadata"><source src="${escapeHtml(media.video)}" type="video/mp4">–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.</video></div>`;
      }
      return "";
    }

    function onOptionChange(e){
      const label = e.target.closest(".option");
      if(!label) return;
      const qid = label.getAttribute("data-qid");
      const q = sectionState.section.questions.find(x=>x.id===qid);
      if(!q) return;
      // —Å–Ω–∏–º–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
      $$(".option", label.parentElement).forEach(optEl => { optEl.classList.remove("correct","wrong"); });

      const selectedIdx = getSelectedOptionIndexes(q);
      const { score, isFullyCorrect } = scoreQuestion(q, selectedIdx);
      sectionState.answered[qid] = selectedIdx;
      sectionState.scores[qid] = score;

      // –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
      const fb = document.getElementById(`fb_${qid}`);
      if(q.type === "single"){
        const chosen = typeof selectedIdx[0] === "number" ? selectedIdx[0] : -1;
        if(chosen>=0){
          if(q.options[chosen].correct){
            fb.textContent = "–í–µ—Ä–Ω–æ";
            fb.className = "q-feedback ok";
            highlightOption(label, true);
          }else{
            fb.textContent = "–ù–µ–≤–µ—Ä–Ω–æ";
            fb.className = "q-feedback bad";
            highlightOption(label, false);
            // –≤—ã–¥–µ–ª–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—á–∏–ª—Å—è
            const ri = q.options.findIndex(o=>o.correct);
            if(ri>=0){
              const rightEl = label.parentElement.querySelector(`[data-oi="${ri}"]`);
              if(rightEl) rightEl.classList.add("correct");
            }
          }
        }else{
          fb.textContent = "";
          fb.className = "q-feedback";
        }
      }else{
        const totalRight = q.options.filter(o=>o.correct).length;
        const pickedRight = selectedIdx.filter(i=>q.options[i]?.correct).length;
        fb.textContent = isFullyCorrect ? "–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ" : `–û—Ç–º–µ—á–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${pickedRight}/${totalRight}`;
        fb.className = isFullyCorrect ? "q-feedback ok" : "q-feedback";
        // –ø–æ–¥—Å–≤–µ—Ç–∏–º –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ
        selectedIdx.forEach(i=>{
          const el = label.parentElement.querySelector(`[data-oi="${i}"]`);
          if(!el) return;
          if(q.options[i].correct) el.classList.add("correct"); else el.classList.add("wrong");
        });
      }

      updateProgress();
      updateSectionScoreLine();
    }

    function getSelectedOptionIndexes(question){
      const opts = $$(".option", findQuestionEl(question.id));
      const arr = [];
      opts.forEach((optEl, idx)=>{
        const input = $("input", optEl);
        if(input && input.checked){ arr.push(idx); }
      });
      return arr;
    }

    function scoreQuestion(q, selectedIdx){
      if(q.type === "single"){
        const chosen = selectedIdx[0];
        if(typeof chosen === "number" && q.options[chosen]?.correct) return { score:1, isFullyCorrect:true };
        return { score:0, isFullyCorrect:false };
      }else{
        const rightIdx = q.options.map((o,i)=>o.correct?i:null).filter(v=>v!==null);
        const setSel = new Set(selectedIdx);
        const setRight = new Set(rightIdx);
        const pickedRight = selectedIdx.filter(i=>setRight.has(i)).length;
        const fully = pickedRight===rightIdx.length && selectedIdx.every(i=>setRight.has(i));
        let s = pickedRight * 0.5;
        if(fully) s = 1; // –ø—Ä–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–µ—Ä–Ω–æ–º –æ—Ç–≤–µ—Ç–µ ‚Äî 1 –±–∞–ª–ª
        if(s>1) s = 1;   // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –æ–≥—Ä–∞–Ω–∏—á–∏–º
        return { score:s, isFullyCorrect:fully };
      }
    }

    function findQuestionEl(qid){
      return $(`.question .options [data-qid="${qid}"]`)?.closest(".question") || null;
    }

    function highlightOption(optionEl, isRight){
      optionEl.classList.add(isRight? "correct":"wrong");
    }

    function updateProgress(){
      const total = sectionState.section.questions.length;
      const answeredCount = Object.keys(sectionState.answered).length;
      const pct = Math.round((answeredCount/Math.max(1,total))*100);
      elProgressBar.style.width = pct + "%";
      elProgressText.textContent = `${answeredCount} –∏–∑ ${total}`;
    }

    function updateSectionScoreLine(){
      const sum = Object.values(sectionState.scores).reduce((a,b)=>a+(b||0),0);
      elSectionScoreLine.innerHTML = `<strong>–ë–∞–ª–ª—ã –∑–∞ —Ä–∞–∑–¥–µ–ª:</strong> ${sum.toFixed(2)}`;
    }

    function finishSection(){
      // –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–¥–µ–ª–∞
      const sectionId = sectionState.section.id;
      const sectionTitle = sectionState.section.title;
      const totalQ = sectionState.section.questions.length;
      const sum = Object.values(sectionState.scores).reduce((a,b)=>a+(b||0),0);
      const answers = {}; // —Å–æ—Ö—Ä–∞–Ω–∏–º –∏–Ω–¥–µ–∫—Å—ã
      sectionState.section.questions.forEach(q=>{
        answers[q.id] = sectionState.answered[q.id] || [];
      });

      sessionResults.push({ sectionId, sectionTitle, questions: totalQ, score: sum, answers });

      // –µ—Å–ª–∏ —Ä–µ–∂–∏–º single ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ä–∞–∑—É –æ–±—â–∏–π –∏—Ç–æ–≥, –∏–Ω–∞—á–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª
      if(runMode === "single"){
        showSummary();
      }else{
        elFinishSection.style.display = "none";
        const hasNext = (currentSectionIndex+1) < QUIZ_DATA.sections.length;
        if(hasNext){
          elNextSection.style.display = "inline-block";
        }else{
          showSummary();
        }
      }
    }

    function showSummary(){
      switchScreen("summary");
      const total = sessionResults.reduce((a,r)=>a+r.score,0);
      const player = readPlayer();
      const ts = new Date().toISOString();

      // —Å–æ—Ö—Ä–∞–Ω–∏–º –≤ localStorage –∏—Å—Ç–æ—Ä–∏—é
      const row = {
        timestamp: ts,
        playerName: player?.name || "",
        playerDept: player?.dept || "",
        sections: sessionResults,
        total: total
      };
      const hist = readResults();
      hist.push(row);
      localStorage.setItem(LS_KEY_RESULTS, JSON.stringify(hist));
      renderHistory();

      // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –∏—Ç–æ–≥
      elTotalsBox.innerHTML = `
        <div class="card" style="margin:0">
          <div><strong>–£—á–∞—Å—Ç–Ω–∏–∫:</strong> ${escapeHtml(player?.name||"")} ${player?.dept? " ‚Ä¢ "+escapeHtml(player.dept):""}</div>
          <div style="margin-top:8px"><strong>–û–±—â–∏–π –±–∞–ª–ª:</strong> ${total.toFixed(2)}</div>
          <div style="margin-top:10px" class="grid">
            ${sessionResults.map(r=>{
              return `<div class="card" style="margin:0">
                <div><b>${escapeHtml(r.sectionTitle)}</b></div>
                <div class="muted">${r.questions} –≤–æ–ø—Ä–æ—Å(–æ–≤)</div>
                <div><b>–ë–∞–ª–ª—ã:</b> ${r.score.toFixed(2)}</div>
              </div>`;
            }).join("")}
          </div>
        </div>
      `;

      // –ø–æ–±–µ–¥–∏—Ç–µ–ª—å?
      if(total >= 5){
        elWinnerBox.style.display = "block";
      }else{
        elWinnerBox.style.display = "none";
      }
    }

    function switchScreen(name){
      [elSections, elQuiz, elSummary].forEach(el=>el.classList.remove("active"));
      if(name==="sections") elSections.classList.add("active");
      if(name==="quiz") elQuiz.classList.add("active");
      if(name==="summary") elSummary.classList.add("active");
    }

    function readResults(){
      try{
        return JSON.parse(localStorage.getItem(LS_KEY_RESULTS)||"[]");
      }catch{ return []; }
    }
    function readPlayer(){
      try{
        return JSON.parse(localStorage.getItem(LS_KEY_PLAYER)||"null");
      }catch{ return null; }
    }

    // —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ JSON
    function exportResults(){
      const data = {
        exportedAt: new Date().toISOString(),
        player: readPlayer(),
        attempts: readResults()
      };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "quiz_results.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (–∫–Ω–æ–ø–∫–∏-¬´–∫–∞—Ä—Ç–æ—á–∫–∏¬ª)
    // (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ grid —É–∂–µ –Ω–∞–≤–µ—à–∞–Ω –≤ init)

    // –£—Ç–∏–ª–∏—Ç–∞
    function escapeHtml(s){
      if(s===undefined||s===null) return "";
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
  </script>

  <!-- –ü–û–î–°–ö–ê–ó–ö–ò –ü–û –ó–ê–ú–ï–ù–ï –ö–û–ù–¢–ï–ù–¢–ê (–æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ HTML –∫–∞–∫ –ø–∞–º—è—Ç–∫–∞):
    1) –ü–æ–ª–æ–∂–∏—Ç–µ –≤–∞—à–∏ –º–µ–¥–∏–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
       - images/logo.png ‚Äî –ª–æ–≥–æ—Ç–∏–ø
       - images/section_art.jpg, images/section_ob.jpg ‚Äî –æ–±–ª–æ–∂–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤
       - images/... –∏ videos/... ‚Äî —Ñ–∞–π–ª—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
    2) –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ QUIZ_DATA:
       - titles/—Ç–µ–∫—Å—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤
       - options[] —Å –ø–æ–º–µ—Ç–∫–æ–π correct:true —É –≤–µ—Ä–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
       - type: "single" (–æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π) –∏–ª–∏ "multi" (–Ω–µ—Å–∫–æ–ª—å–∫–æ)
    3) –û–ø—É–±–ª–∏–∫—É–π—Ç–µ —á–µ—Ä–µ–∑ GitHub Pages: Settings ‚Üí Pages ‚Üí Source: main / (root)
    4) –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—é –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—É–º–º–µ ‚â• 5 –±–∞–ª–ª–æ–≤.
    5) –ö–æ–Ω—Å–∏–ª–∏—É–º ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–≥—Ä–∞; –¥–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ QUIZ_DATA.consiliumUrl.
  -->
</body>
</html>
